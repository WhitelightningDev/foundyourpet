# Push notifications (FCM)

This frontend supports **standards-based Web Push** (desktop + Android, and iOS PWAs when installed) and optionally Firebase Cloud Messaging (FCM) for app-style tokens.

## Frontend env vars

Set these in your deployment environment (or local `.env`):

- `REACT_APP_WEB_PUSH_PUBLIC_KEY` (VAPID public key; optional if backend exposes `/api/notifications/webpush/public-key`)

- `REACT_APP_FIREBASE_API_KEY`
- `REACT_APP_FIREBASE_AUTH_DOMAIN`
- `REACT_APP_FIREBASE_PROJECT_ID`
- `REACT_APP_FIREBASE_STORAGE_BUCKET`
- `REACT_APP_FIREBASE_MESSAGING_SENDER_ID`
- `REACT_APP_FIREBASE_APP_ID`
- `REACT_APP_FIREBASE_VAPID_KEY` (Web Push certificate key from Firebase console)

Optional API paths:

- `REACT_APP_NOTIFICATIONS_REGISTER_PATH` (default: `/api/notifications/register`)
- `REACT_APP_PUBLIC_PET_REPORT_PATH` (default: `/api/reports/public-pet`)

## What’s implemented in the frontend

- Service worker generation for background messages: `public/push-sw.js` (generated by `scripts/generate-firebase-messaging-sw.cjs` on `npm start` / `npm run build`).
- “Enable notifications” button on the homepage: `src/components/EnableNotificationsButton.jsx`.
- Foreground message handling (shows a toast): `src/App.js`.
- Public report submission posts to the backend (with localStorage fallback if the API is unavailable): `src/pages/Home.jsx`.

## Backend requirements (to actually broadcast notifications)

1) Token registration endpoint (called from the browser):

- `POST /api/notifications/register`
- JSON body: `{ token: string, platform: "web" | "ios" | "android", userAgent?: string }`
- Store tokens and de-duplicate them.

1b) Web Push subscription endpoint (recommended for PWAs / desktop):

- `POST /api/notifications/webpush/subscribe`
- JSON body: `{ subscription: PushSubscription, platform?: string, userAgent?: string }`

2) Public report creation endpoint (called from the homepage form):

- `POST /api/reports/public-pet` (multipart form-data)
- Fields: `firstName`, `lastName`, `phoneNumber`, `petStatus`, `location`, `description?`, `photo` (file)

3) On successful report creation, send an FCM push to all tokens (or to a topic you manage on the server).

Recommended payload shape for web:

- `notification.title`: `"New lost/found pet report"`
- `notification.body`: short summary (e.g. `"Found near Parkhurst, Johannesburg"`)
- `data.url`: a path like `"/"` or `"/reports/<id>"`

## iPhone / iPad notes

Web Push on iOS requires:
- iOS/iPadOS 16.4+
- The site installed to the Home Screen (PWA / standalone mode)
